### 1.7 싱글스레드와 멀티 스레드의 게임 서버

###### 많은 상용 게임서버는 CPU가 여러 코어로 구성되어 있다.

###### 따라서 게임 서버를 싱글스레드로 구동하는 경우 코어 하나만 사용하게 되는 비효율성 문제가 생긴다.

#### 1.7.1 - 싱글스레드 게임 서버

###### 싱글스레드 서버를 구동하는 경우는 CPU개수만큼 프로세스를 띄우는 것이 일반적이다.

![게임 서버 프로그래밍 교과서: 1.10 싱글스레드 게임 서버](https://thebook.io/img/006884/p071.jpg)

> ###### 싱글스레드 프로세스는 방을 여러게 가지게 된다.
> 
> ###### 방에서는 플레이어 하나 이상이 싱글 혹은 멀티 플레이를 하게 된다.
> 
> ###### 싱글스레드로 게임 서버를 만드는 경우, 디스크에서 플레이어 정보를 로딩할 때 발생하는 디바이스 타임을 처리하는 과정에서 큰 시리얼 병목이 일어난다.
> 
> ### - 여기서 알아야 할 것
> 
> > ![Parallelism(병렬성)과 Concurrency(동시성)](https://blog.kakaocdn.net/dn/bhvIvr/btq2gWwhEYF/IYUjohycZ4WD5q4K0tVFV0/img.png)
> > 
> > ###### 여러 CPU가 각 스레드 연산을 하여 동시 처리량을 높이는 것을 "병렬성"이라 한다.
> > 
> > ###### 하지만 "병렬성" 원해서 병렬로 실행되게 만든 프로그램이 정작 한 CPU만 일 하는 것을 "시리얼 병목"이라고 한다.
> > 
> > ###### 때문에 "시리얼 병목"이 발생하는 구간을 최소화 하는 것이 관건이다.
> > 
> > ###### 또한 기기에 있는 장치(디스크 등등..)에 뭔가를 요청해서 결과를 얻기 까지 걸리는 시간을 "디바이스 타임"이라고 한다.
> > 
> > ###### 때문에 '잠금'을 하고 디바이스 타임을 갖게 되면 시리얼 병목이 일어나게 된다.

#### 1.7.2 멀티스레드 게임 서버

###### 멀티스레드 게임 서버를 사용하는 이유

###### 1. 서버 프로세스를 많이 띄우기 곤란할 때

###### - (ex 프로세스당 로딩해야 하는 게임정보 (맵테이터 등) 의 용량이 매우 클 때 like MMO 게임 서버)

###### 2. 서버 한 대의 프로세스가 여러 CPU의 연산량을 동원해야 할 만큼 많은 연산을 할 때

###### 3. 코루틴이나 비동기 함수를 쓸 수 없고 디바이스 타임이 발생할 때

###### 4. 서버 인스턴스를 서버 기기당 하나만 두어야 할 때

###### 5. 서로 다른 방이 같은 메모리 공간을 엑세스 해야 할 때

> ###### 멀티스레드 게임 서버는 잠금 단위를 설정해 주어야 한다.
> 
> ###### 보통은 방 단위로 잠금 설정을 하게 된다.
> 
> ![게임 서버 프로그래밍 교과서: 1.11 멀티스레드 게임 서버](https://thebook.io/img/006884/p072.jpg)
